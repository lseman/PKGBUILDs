# Maintainer: Antonio Rojas <arojas@archlinux.org>
# Contributor: Ronald van Haren <ronald.archlinux.org>

pkgname=suitesparse-cholmod
pkgver=7.4.0.beta10.r0.gee01a67e8
pkgrel=1
pkgdesc='A collection of sparse matrix libraries'
url='http://faculty.cse.tamu.edu/davis/suitesparse.html'
arch=(x86_64)
conflicts=('suitesparse')
depends=(blas
         gcc-libs
         glibc
         gmp
         lapack
         mpfr)
makedepends=(cmake
             gcc-fortran)
replaces=('suitesparse64<7.1.0')
license=(GPL)
source=(git+https://github.com/DrTimothyAldenDavis/SuiteSparse/)
sha256sums=('SKIP')
options=('!lto')
# get pkgver from git
pkgver() {

   cd "$srcdir/SuiteSparse"
   git describe --long --tags | sed 's/^v//;s/\([^-]*-g\)/r\1/;s/-/./g'
}


build() {
  source /opt/intel/oneapi/setvars.sh
  cd SuiteSparse
  cmake -DCMAKE_INSTALL_PREFIX=/usr \
                 -DSUITESPARSE_ENABLE_PROJECTS=cholmod
  make CHOLMOD_static -j$(nproc)
}

package() {
  cd SuiteSparse
  DESTDIR="$pkgdir" make install
}
